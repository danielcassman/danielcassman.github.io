var STOCKS=["INX","DJI","IXIC"],STOCKSIEX=["DIA","QQQ","SPY","IWD","IWF","IEFA"],DEFAULT_LOCATION={coords:{latitude:38.8942345,longitude:-77.0295696}};WEATHER_UPDATE=6e5,STOCKS_UPDATE=6e4,NEWS_UPDATE=6e5,OPM_UPDATE=6e5;var URLS={weather:"https://www.wunderground.com/",stocks:"https://finance.yahoo.com/portfolio/pf_1/view/v1?bypass=true"};function ready(e){(document.attachEvent?"complete"===document.readyState:"loading"!==document.readyState)?e():document.addEventListener("DOMContentLoaded",e)}function setUpWeather(){document.getElementById("weather-button").addEventListener("click",function(){return fadeToggle(document.getElementById("weather-info")),!1}),document.getElementById("weather-info").addEventListener("click",function(){return window.open(URLS.weather),!1}),getLocationAndUpdateWeather()}function getLocationAndUpdateWeather(){var e=parse_query_string(window.location.search.substring(1));"default"==e.location?(console.log("Default location selected, using that."),loadLocalWeatherOpenWeatherMap(DEFAULT_LOCATION)):e.latitude&&e.longitude&&-90<=e.latitude&&e.latitude<=90&&-180<=e.longitude&&e.longitude<=180?loadLocalWeatherOpenWeatherMap({coords:{latitude:e.latitude,longitude:e.longitude}}):navigator.geolocation?navigator.geolocation.getCurrentPosition(loadLocalWeatherOpenWeatherMap,noLocationAvailable):loadLocalWeather(DEFAULT_LOCATION)}function loadLocalWeatherOpenWeatherMap(e,t){e=void 0!==e?e:DEFAULT_LOCATION,t=void 0!==t?t:WEATHER_UPDATE;var n=new XMLHttpRequest;url="https://api.openweathermap.org/data/2.5/weather?lat="+ +e.coords.latitude+"&lon="+e.coords.longitude+"&appid=28a3dfeb56dc6ea450c7e494fb061503",n.open("GET",url,!0),n.onload=function(){200<=n.status&&n.status<400?applyWeatherOpenWeatherMap(JSON.parse(n.responseText)):logUpdate("Unable to reach OpenWeatherMap API. "+responseText)},n.onerror=function(){logUpdate("Unable to reach OpenWeatherMap API. "+responseText)},n.send(),t&&setTimeout(function(){loadLocalWeatherOpenWeatherMap(e)},t)}function applyWeatherOpenWeatherMap(e){document.getElementById("condition").textContent=e.weather[0].description,document.getElementById("temperature").innerHTML=Math.round(9*e.main.temp/5-459.67)+"&deg;",document.getElementById("icon").setAttribute("class","wi wi-owm-"+e.weather[0].id),document.getElementById("location").textContent=e.name;var t=getBackgroundImageOpenWeatherMap(e.weather[0].id,e.sys);document.getElementById("main-wrap").style.backgroundImage="url(assets/images/s2048/"+t+")"}function noLocationAvailable(e){logUpdate("Location issue: "+e.message),loadLocalWeatherOpenWeatherMap(DEFAULT_LOCATION)}function getBackgroundImageOpenWeatherMap(e,t){var n="clear";switch(Math.round(e/100)){case 2:n="lightning";break;case 3:n="drizzle";break;case 5:500!=e&&501!=e&&511!=e&&520!=e&&521!=e||(n="rain"),502!=e&&503!=e&&504!=e&&522!=e&&531!=e||(n="heavyrain");break;case 6:600!=e&&615!=e&&620!=e||(n="lightsnow"),601!=e&&611!=e&&612!=e&&616!=e&&621!=e||(n="snow"),602!=e&&622!=e||(n="heavysnow");break;case 7:n=701==e||741==e||771==e?"foggy":"haze";break;case 8:801==e&&(n="partlysunny"),802==e&&(n="partlycloudy"),803==e&&(n="mostlycloudy"),804==e&&(n="cloudy")}var a=new Date,o=Math.floor(a.getTime()/1e3),s="night";return o>=t.sunrise&&o<=t.sunset&&(s="day"),s+"-"+n+"-0"+Math.floor(4*Math.random()+1)+".jpg"}function setUpStocks(){document.getElementById("stocks").style.opacity=0,document.getElementById("stocks-button").addEventListener("click",function(){return fadeToggle(document.getElementById("stocks")),!1}),document.getElementById("stocks").addEventListener("click",function(){return window.open(URLS.stocks),!1}),loadStocksIEX(STOCKSIEX,"stocks",STOCKS_UPDATE)}function loadStocksIEX(e,a,t){e=void 0!==e?e:STOCKSIEX,a=void 0!==t?a:"stocks",t=void 0!==t&&t;var n,o=[];for(n=0;n<e.length;n++)!function(n){o[n]=new XMLHttpRequest,o[n].open("GET","https://api.iextrading.com/1.0/stock/"+e[n]+"/quote",!0),o[n].onload=function(){if(200<=o[n].status&&o[n].status<400){var e=JSON.parse(o[n].responseText),t=document.getElementById("stock-"+e.symbol);t||((t=document.createElement("div")).setAttribute("class","stock"),t.setAttribute("id","stock-"+e.symbol),document.getElementById(a).appendChild(t)),updateStockItemIEX(e,t)}else logUpdate("Unable to reach IEX API. "+responseText)},o[n].onerror=function(){logUpdate("There was an error reaching the IEX API.")},o[n].send()}(n);t&&setTimeout(function(){loadStocksIEX(e,a,t)},t)}function updateStockItemIEX(e,t){for(;t.firstChild;)t.removeChild(t.firstChild);var n=document.createElement("span");n.setAttribute("class","stock-symbol"),n.textContent=e.symbol;var a=document.createElement("span");a.setAttribute("class","stock-price"),a.textContent=decimalPlaces(e.latestPrice,2);var o=document.createElement("span"),s=decimalPlaces(100*e.changePercent,2);o.setAttribute("class","stock-change "+(s<0?"negative":"positive")),o.textContent="("+(s<0?"":"+")+s+"%)",t.appendChild(n),t.appendChild(a),t.appendChild(o)}function setUpNews(e){update=void 0!==e?e:"NYT",document.getElementById("news").style.opacity=0,document.getElementById("news-button").addEventListener("click",function(){return fadeToggle(document.getElementById("news")),!1}),"Guardian"==e&&(updateGuardianHeadlines("us-news","#us"),updateGuardianHeadlines("world","#world")),updateNYTHeadlines("#nyt",12,NEWS_UPDATE)}function updateNYTHeadlines(r,d,e){d=void 0!==d?d:10,e=void 0!==e&&e;var i=new XMLHttpRequest;i.open("GET","https://api.nytimes.com/svc/topstories/v2/home.json?api-key=a300a0adf8fa418f903e7cbd2355a805",!0),i.onload=function(){if(200<=i.status&&i.status<400){for(var e=JSON.parse(i.responseText).results,t=document.querySelector(r).querySelectorAll("a.article"),n=0;n<t.length;n++)t[n].parentNode.removeChild(t[n]);var a=0;for(n=0;n<e.length&&a<d;n++){var o=e[n],s=document.createElement("a");s.setAttribute("class","article"),s.innerHTML=o.title,s.setAttribute("href",o.url),s.setAttribute("target","_blank"),document.querySelector(r).appendChild(s),a++}}else logUpdate("The New York Times API returned an error. News not updated.")},i.onerror=function(){logUpdate("Unable to reach the New York Times website.")},i.send(),e&&setTimeout(function(){updateNYTHeadlines(r,d,e)},e)}function updateGuardianHeadlines(e,r,d){d=void 0!==d?d:5;var i=new XMLHttpRequest;i.open("GET","https://content.guardianapis.com/search?section="+e+"&api-key=5d33b608-c47b-4f64-99c3-59c8deb3c857",!0),i.onload=function(){if(200<=i.status&&i.status<400){for(var e=JSON.parse(i.responseText).response.results,t=document.querySelector(r).querySelectorAll("a.article"),n=0;n<t.length;n++)t[n].parentNode.removeChild(t[n]);var a=0;for(n=0;n<e.length&&a<d;n++){var o=e[n];if("article"==o.type){var s=document.createElement("a");s.setAttribute("class","article"),s.innerHTML=o.webTitle,s.setAttribute("href",o.webUrl),s.setAttribute("target","_blank"),document.querySelector(r).appendChild(s),a++}}logUpdate("News updated from The Guardian.")}else logUpdate("The Guardian API returned an error. News not updated.")},i.onerror=function(){logUpdate("Unable to reach The Guardian website.")},i.send()}function setUpOPM(){document.getElementById("opmstatus").style.opacity=0,document.getElementById("opmstatus").addEventListener("click",function(){return window.open(URLS.opm),!1}),document.getElementById("opm-button").addEventListener("click",function(){return fadeToggle(document.getElementById("opmstatus")),!1}),updateOPMStatus(OPM_UPDATE)}function updateOPMStatus(e){max_stories="undefined"!=typeof max_stories?max_stories:10,update="undefined"!=typeof update&&update;var o=new XMLHttpRequest;o.open("GET","https://www.opm.gov/json/operatingstatus.json",!0),o.onload=function(){if(200<=o.status&&o.status<400){var e=JSON.parse(o.responseText);document.getElementById("opm-wrapper").innerHTML="";var t=document.createElement("span");t.setAttribute("class","opm-status-date"),t.textContent=e.AppliesTo;var n=document.createElement("span");n.setAttribute("class","opm-current-status"),n.textContent=e.StatusSummary,"Open"==e.StatusSummary?n.setAttribute("class","opm-current-status open"):-1!=e.StatusSummary.indexOf("Closed")?n.setAttribute("class","opm-current-status closed"):-1!=e.StatusSummary.indexOf("Delayed")&&n.setAttribute("class","opm-current-status delayed");var a=document.createElement("span");a.setAttribute("class","opm-status-summary"),a.textContent=e.ShortStatusMessage,document.getElementById("opm-wrapper").appendChild(t),document.getElementById("opm-wrapper").appendChild(n),document.getElementById("opm-wrapper").appendChild(a),URLS.opm=e.Url}else logUpdate("The OPM tool returned an error. OPM status not updated.")},o.onerror=function(){logUpdate("Unable to reach the New York Times website.")},o.send(),e&&setTimeout(function(){updateOPMStatus(e)},e)}function fadeToggle(e){0==e.style.opacity&&""!=e.style.opacity?fadeIn(e):fadeOut(e)}function fadeIn(e,t,n){t=void 0!==t?t:16,n=void 0!==n?n:.05,e.style.opacity=0,e.style.display="block";var a=function(){e.style.opacity=+e.style.opacity+n,+e.style.opacity<1&&(window.requestAnimationFrame&&requestAnimationFrame(a)||setTimeout(a,t))};a()}function fadeOut(e,t,n){t=void 0!==t?t:16,n=void 0!==n?n:.05,e.style.opacity=1;var a=function(){e.style.opacity=+e.style.opacity-n,0<+e.style.opacity?window.requestAnimationFrame&&requestAnimationFrame(a)||setTimeout(a,t):e.style.display="none"};a()}function decimalPlaces(e,t){e=+e,-1==(e="a"+(e=Math.round(e*Math.pow(10,t))/Math.pow(10,t))).indexOf(".")&&(e+=".");for(var n=t-(e=e.split("."))[1].length,a=0;a<n;a++)e[1]+="0";return e[0]=e[0].substring(1),e=e.join(".")}function logUpdate(e){d=new Date,console.log(d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()+" "+d.getHours()+":"+(d.getMinutes()<10?"0"+d.getMinutes():d.getMinutes())+": "+e)}function parse_query_string(e){for(var t=e.split("&"),n={},a=0;a<t.length;a++){var o=t[a].split("=");if(void 0===n[o[0]])n[o[0]]=decodeURIComponent(o[1]);else if("string"==typeof n[o[0]]){var s=[n[o[0]],decodeURIComponent(o[1])];n[o[0]]=s}else n[o[0]].push(decodeURIComponent(o[1]))}return n}function setUp(){setUpWeather(),setUpStocks(),setUpNews(),setUpOPM()}ready(setUp);

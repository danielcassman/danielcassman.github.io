function ready(e){(document.attachEvent?"complete"===document.readyState:"loading"!==document.readyState)?e():document.addEventListener("DOMContentLoaded",e)}function setUpWeather(){document.getElementById("weather-button").addEventListener("click",function(){return fadeToggle(document.getElementById("weather-info")),!1}),getLocationAndUpdateWeather()}function getLocationAndUpdateWeather(){var e=parse_query_string(window.location.search.substring(1));"default"==e.location?(console.log("Default location selected, using that."),loadLocalWeather(DEFAULT_LOCATION)):e.latitude&&e.longitude&&e.latitude>=-90&&e.latitude<=90&&e.longitude>=-180&&e.longitude<=180?loadLocalWeather({coords:{latitude:e.latitude,longitude:e.longitude}}):navigator.geolocation?navigator.geolocation.getCurrentPosition(loadLocalWeather,noLocationAvailable):loadLocalWeather(DEFAULT_LOCATION)}function loadLocalWeather(e,t){e="undefined"!=typeof e?e:DEFAULT_LOCATION,t="undefined"!=typeof t?t:WEATHER_UPDATE;var n=new XMLHttpRequest;url="https://api.openweathermap.org/data/2.5/weather?lat="+e.coords.latitude+"&lon="+e.coords.longitude+"&appid=b2f350cd6c8d249908dd100bba6c6e7c",n.open("GET",url,!0),n.onload=function(){if(n.status>=200&&n.status<400){var e=JSON.parse(n.responseText);applyWeather(e),logUpdate("Weather updated from OpenWeatherMap.")}else logUpdate("Unable to reach OpenWeatherMap API. "+responseText)},n.onerror=function(){logUpdate("Unable to reach OpenWeatherMap API. "+responseText)},n.send(),t&&setTimeout(function(){loadLocalWeather(e)},t)}function noLocationAvailable(e){logUpdate("Location issue: "+e.message),loadLocalWeather(DEFAULT_LOCATION)}function applyWeather(e){document.getElementById("condition").textContent=e.weather[0].description,document.getElementById("temperature").innerHTML=Math.round(9*e.main.temp/5-459.67,0)+"&deg;",document.getElementById("icon").setAttribute("class","wi wi-owm-"+e.weather[0].id),document.getElementById("location").textContent=e.name;var t=getBackgroundImage(e.weather[0].id,e.sys);document.getElementById("main-wrap").style.backgroundImage="url(assets/images/s2048/"+t+")"}function getBackgroundImage(e,t){var n="clear";e>=200&&300>e&&(n="lightning"),e>=300&&400>e&&(n="rain"),e>=500&&600>e&&(n="rain"),(e>501&&520>e||e>521&&531>e||e>=958&&961>=e)&&(n="heavyrain"),e>=600&&700>e&&(n="snow"),(600==e||615==e||620==e)&&(n="flurries"),(711==e||721==e||731==e)&&(n="haze"),(701==e||741==e)&&(n="foggy"),(801==e||802==e)&&(n="fewclouds"),803==e&&(n="partlycloudy"),804==e&&(n="cloudy");var o=new Date,a=Math.floor(o.getTime()/1e3);return(a>t.sunrise&&a<t.sunset?"day":"night")+"-"+n+"-01.jpg"}function setUpStocks(){document.getElementById("stocks").style.opacity=0,document.getElementById("stocks-button").addEventListener("click",function(){return fadeToggle(document.getElementById("stocks")),!1}),loadStocks(STOCKS,"#stocks",STOCKS_UPDATE)}function loadStocks(e,t,n){stocks="undefined"!=typeof stocks?stocks:STOCKS,t="undefined"!=typeof n?t:"#stocks",n="undefined"!=typeof n?n:!1;var o=new XMLHttpRequest,a="https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20yahoo.finance.quotes%20where%20symbol%20in%20(%22"+e.join(",")+"%22)&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&callback=";o.open("GET",a,!0),o.onload=function(){if(o.status>=200&&o.status<400){var e=JSON.parse(o.responseText),n=e.query.results.quote;if(Array.isArray(n)){for(var a=document.querySelector(t).querySelectorAll("div.stock"),r=0;r<a.length;r++)a[r].parentNode.removeChild(a[r]);for(var r=0;r<n.length;r++)createStockItem(n[r],t)}logUpdate("Stocks updated from Yahoo.")}else logUpdate("Unable to reach Yahoo Stocks API. "+responseText)},o.onerror=function(){logUpdate("There was an error reaching the Yahoo Stocks API.")},o.send(),n&&setTimeout(function(){loadStocks(e,t,n)},n)}function createStockItem(e,t){var n=document.createElement("div");n.setAttribute("class","stock");var o=document.createElement("span");o.setAttribute("class","stock-symbol"),o.textContent=e.symbol;var a=document.createElement("span");a.setAttribute("class","stock-price"),a.textContent=decimalPlaces(e.LastTradePriceOnly,2);var r=document.createElement("span"),d=e.Change;null==e.Change&&(d=e.LastTradePriceOnly-e.PreviousClose),d=decimalPlaces(d,2),r.setAttribute("class","stock-change "+(0>d?"negative":"positive")),r.textContent="("+(0>d?"":"+")+d+")",n.appendChild(o),n.appendChild(a),n.appendChild(r),document.querySelector(t).appendChild(n)}function setUpNews(e){update="undefined"!=typeof e?e:"NYT",document.getElementById("news").style.opacity=0,document.getElementById("news-button").addEventListener("click",function(){return fadeToggle(document.getElementById("news")),!1}),"Guardian"==e&&(updateGuardianHeadlines("us-news","#us"),updateGuardianHeadlines("world","#world")),updateNYTHeadlines("#nyt",12,NEWS_UPDATE)}function updateNYTHeadlines(e,t,n){t="undefined"!=typeof t?t:10,n="undefined"!=typeof n?n:!1;var o="https://api.nytimes.com/svc/topstories/v2/home.json";o+="?api-key=a300a0adf8fa418f903e7cbd2355a805";var a=new XMLHttpRequest;a.open("GET",o,!0),a.onload=function(){if(a.status>=200&&a.status<400){for(var n=JSON.parse(a.responseText),o=n.results,r=document.querySelector(e).querySelectorAll("a.article"),d=0;d<r.length;d++)r[d].parentNode.removeChild(r[d]);for(var s=0,d=0;d<o.length&&t>s;d++){var i=o[d],l=document.createElement("a");l.setAttribute("class","article"),l.innerHTML=i.title,l.setAttribute("href",i.url),l.setAttribute("target","_blank"),document.querySelector(e).appendChild(l),s++}logUpdate("News updated from the New York Times.")}else logUpdate("The New York Times API returned an error. News not updated.")},a.onerror=function(){logUpdate("Unable to reach the New York Times website.")},a.send(),n&&setTimeout(function(){updateNYTHeadlines(e,t,n)},n)}function updateGuardianHeadlines(e,t,n){n="undefined"!=typeof n?n:5;var o=new XMLHttpRequest;o.open("GET","https://content.guardianapis.com/search?section="+e+"&api-key=5d33b608-c47b-4f64-99c3-59c8deb3c857",!0),o.onload=function(){if(o.status>=200&&o.status<400){for(var e=JSON.parse(o.responseText),a=e.response.results,r=document.querySelector(t).querySelectorAll("a.article"),d=0;d<r.length;d++)r[d].parentNode.removeChild(r[d]);for(var s=0,d=0;d<a.length&&n>s;d++){var i=a[d];if("article"==i.type){var l=document.createElement("a");l.setAttribute("class","article"),l.innerHTML=i.webTitle,l.setAttribute("href",i.webUrl),l.setAttribute("target","_blank"),document.querySelector(t).appendChild(l),s++}}logUpdate("News updated from The Guardian.")}else logUpdate("The Guardian API returned an error. News not updated.")},o.onerror=function(){logUpdate("Unable to reach The Guardian website.")},o.send()}function fadeToggle(e){0==e.style.opacity&&""!=e.style.opacity?fadeIn(e):fadeOut(e)}function fadeIn(e,t,n){t="undefined"!=typeof t?t:16,n="undefined"!=typeof n?n:.05,e.style.opacity=0,e.style.display="block";var o=function(){e.style.opacity=+e.style.opacity+n,+e.style.opacity<1&&(window.requestAnimationFrame&&requestAnimationFrame(o)||setTimeout(o,t))};o()}function fadeOut(e,t,n){t="undefined"!=typeof t?t:16,n="undefined"!=typeof n?n:.05,e.style.opacity=1;var o=function(){e.style.opacity=+e.style.opacity-n,+e.style.opacity>0?window.requestAnimationFrame&&requestAnimationFrame(o)||setTimeout(o,t):e.style.display="none"};o()}function decimalPlaces(e,t){e=+e,e=Math.round(e*Math.pow(10,t))/Math.pow(10,t),e="a"+e,-1==e.indexOf(".")&&(e+="."),e=e.split(".");for(var n=t-e[1].length,o=0;n>o;o++)e[1]+="0";return e[0]=e[0].substring(1),e=e.join(".")}function logUpdate(e){d=new Date,console.log(d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()+" "+d.getHours()+":"+(d.getMinutes()<10?"0"+d.getMinutes():d.getMinutes())+": "+e)}function parse_query_string(e){for(var t=e.split("&"),n={},o=0;o<t.length;o++){var a=t[o].split("=");if("undefined"==typeof n[a[0]])n[a[0]]=decodeURIComponent(a[1]);else if("string"==typeof n[a[0]]){var r=[n[a[0]],decodeURIComponent(a[1])];n[a[0]]=r}else n[a[0]].push(decodeURIComponent(a[1]))}return n}function setUp(){setUpWeather(),setUpStocks(),setUpNews()}var STOCKS=["IWD","IWF","^IXIC","^GSPC","ES=F"],DEFAULT_LOCATION={coords:{latitude:38.8942345,longitude:-77.0295696}};WEATHER_UPDATE=9e5,STOCKS_UPDATE=3e5,NEWS_UPDATE=6e5,ready(setUp);

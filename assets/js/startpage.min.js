function ready(e){(document.attachEvent?"complete"===document.readyState:"loading"!==document.readyState)?e():document.addEventListener("DOMContentLoaded",e)}function setUpWeather(){document.getElementById("weather-button").addEventListener("click",function(){return fadeToggle(document.getElementById("weather-info")),!1}),document.getElementById("weather-info").addEventListener("click",function(){return window.open(URLS.weather),!1}),getLocationAndUpdateWeather()}function getLocationAndUpdateWeather(){var e=parse_query_string(window.location.search.substring(1));"default"==e.location?(console.log("Default location selected, using that."),loadLocalWeather(DEFAULT_LOCATION)):e.latitude&&e.longitude&&e.latitude>=-90&&e.latitude<=90&&e.longitude>=-180&&e.longitude<=180?loadLocalWeather({coords:{latitude:e.latitude,longitude:e.longitude}}):navigator.geolocation?navigator.geolocation.getCurrentPosition(loadLocalWeather,noLocationAvailable):loadLocalWeather(DEFAULT_LOCATION)}function loadLocalWeather(e,t){e=void 0!==e?e:DEFAULT_LOCATION,t=void 0!==t?t:WEATHER_UPDATE;var o=new XMLHttpRequest;url="https://api.openweathermap.org/data/2.5/weather?lat="+e.coords.latitude+"&lon="+e.coords.longitude+"&appid=b2f350cd6c8d249908dd100bba6c6e7c",o.open("GET",url,!0),o.onload=function(){o.status>=200&&o.status<400?(applyWeather(JSON.parse(o.responseText)),logUpdate("Weather updated from OpenWeatherMap.")):logUpdate("Unable to reach OpenWeatherMap API. "+responseText)},o.onerror=function(){logUpdate("Unable to reach OpenWeatherMap API. "+responseText)},o.send(),t&&setTimeout(function(){loadLocalWeather(e)},t)}function noLocationAvailable(e){logUpdate("Location issue: "+e.message),loadLocalWeather(DEFAULT_LOCATION)}function applyWeather(e){document.getElementById("condition").textContent=e.weather[0].description,document.getElementById("temperature").innerHTML=Math.round(9*e.main.temp/5-459.67,0)+"&deg;",document.getElementById("icon").setAttribute("class","wi wi-owm-"+e.weather[0].id),document.getElementById("location").textContent=e.name;var t=getBackgroundImage(e.weather[0].id,e.sys);document.getElementById("main-wrap").style.backgroundImage="url(assets/images/s2048/"+t+")"}function getBackgroundImage(e,t){var o="clear";e>=200&&e<300&&(o="lightning"),e>=300&&e<400&&(o="rain"),e>=500&&e<600&&(o="rain"),(e>501&&e<520||e>521&&e<531||e>=958&&e<=961)&&(o="heavyrain"),e>=600&&e<700&&(o="snow"),600!=e&&615!=e&&620!=e||(o="flurries"),711!=e&&721!=e&&731!=e||(o="haze"),701!=e&&741!=e||(o="foggy"),801!=e&&802!=e||(o="fewclouds"),803==e&&(o="partlycloudy"),804==e&&(o="cloudy");var n=new Date,a=Math.floor(n.getTime()/1e3);return(a>t.sunrise&&a<t.sunset?"day":"night")+"-"+o+"-01.jpg"}function setUpStocks(){document.getElementById("stocks").style.opacity=0,document.getElementById("stocks-button").addEventListener("click",function(){return fadeToggle(document.getElementById("stocks")),!1}),document.getElementById("weather-info").addEventListener("click",function(){return window.open(URLS.stocks),!1}),loadStocks(STOCKS,"#stocks",STOCKS_UPDATE)}function loadStocks(e,t,o){stocks="undefined"!=typeof stocks?stocks:STOCKS,t=void 0!==o?t:"#stocks",o=void 0!==o&&o;var n=new XMLHttpRequest,a="https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20yahoo.finance.quotes%20where%20symbol%20in%20(%22"+e.join(",")+"%22)&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&callback=";n.open("GET",a,!0),n.onload=function(){if(n.status>=200&&n.status<400){var e=JSON.parse(n.responseText).query.results.quote;if(Array.isArray(e)){for(var o=document.querySelector(t).querySelectorAll("div.stock"),a=0;a<o.length;a++)o[a].parentNode.removeChild(o[a]);for(a=0;a<e.length;a++)createStockItem(e[a],t)}logUpdate("Stocks updated from Yahoo.")}else logUpdate("Unable to reach Yahoo Stocks API. "+responseText)},n.onerror=function(){logUpdate("There was an error reaching the Yahoo Stocks API.")},n.send(),o&&setTimeout(function(){loadStocks(e,t,o)},o)}function createStockItem(e,t){var o=document.createElement("div");o.setAttribute("class","stock");var n=document.createElement("span");n.setAttribute("class","stock-symbol"),n.textContent=e.symbol;var a=document.createElement("span");a.setAttribute("class","stock-price"),a.textContent=decimalPlaces(e.LastTradePriceOnly,2);var r=document.createElement("span"),s=e.Change;null==e.Change&&(s=e.LastTradePriceOnly-e.PreviousClose),s=decimalPlaces(s,2),r.setAttribute("class","stock-change "+(s<0?"negative":"positive")),r.textContent="("+(s<0?"":"+")+s+")",o.appendChild(n),o.appendChild(a),o.appendChild(r),document.querySelector(t).appendChild(o)}function setUpNews(e){update=void 0!==e?e:"NYT",document.getElementById("news").style.opacity=0,document.getElementById("news-button").addEventListener("click",function(){return fadeToggle(document.getElementById("news")),!1}),"Guardian"==e&&(updateGuardianHeadlines("us-news","#us"),updateGuardianHeadlines("world","#world")),updateNYTHeadlines("#nyt",12,NEWS_UPDATE)}function updateNYTHeadlines(e,t,o){t=void 0!==t?t:10,o=void 0!==o&&o;var n="https://api.nytimes.com/svc/topstories/v2/home.json";n+="?api-key=a300a0adf8fa418f903e7cbd2355a805";var a=new XMLHttpRequest;a.open("GET",n,!0),a.onload=function(){if(a.status>=200&&a.status<400){for(var o=JSON.parse(a.responseText).results,n=document.querySelector(e).querySelectorAll("a.article"),r=0;r<n.length;r++)n[r].parentNode.removeChild(n[r]);for(var s=0,r=0;r<o.length&&s<t;r++){var d=o[r],i=document.createElement("a");i.setAttribute("class","article"),i.innerHTML=d.title,i.setAttribute("href",d.url),i.setAttribute("target","_blank"),document.querySelector(e).appendChild(i),s++}logUpdate("News updated from the New York Times.")}else logUpdate("The New York Times API returned an error. News not updated.")},a.onerror=function(){logUpdate("Unable to reach the New York Times website.")},a.send(),o&&setTimeout(function(){updateNYTHeadlines(e,t,o)},o)}function updateGuardianHeadlines(e,t,o){o=void 0!==o?o:5;var n=new XMLHttpRequest;n.open("GET","https://content.guardianapis.com/search?section="+e+"&api-key=5d33b608-c47b-4f64-99c3-59c8deb3c857",!0),n.onload=function(){if(n.status>=200&&n.status<400){for(var e=JSON.parse(n.responseText).response.results,a=document.querySelector(t).querySelectorAll("a.article"),r=0;r<a.length;r++)a[r].parentNode.removeChild(a[r]);for(var s=0,r=0;r<e.length&&s<o;r++){var d=e[r];if("article"==d.type){var i=document.createElement("a");i.setAttribute("class","article"),i.innerHTML=d.webTitle,i.setAttribute("href",d.webUrl),i.setAttribute("target","_blank"),document.querySelector(t).appendChild(i),s++}}logUpdate("News updated from The Guardian.")}else logUpdate("The Guardian API returned an error. News not updated.")},n.onerror=function(){logUpdate("Unable to reach The Guardian website.")},n.send()}function fadeToggle(e){0==e.style.opacity&&""!=e.style.opacity?fadeIn(e):fadeOut(e)}function fadeIn(e,t,o){t=void 0!==t?t:16,o=void 0!==o?o:.05,e.style.opacity=0,e.style.display="block";var n=function(){e.style.opacity=+e.style.opacity+o,+e.style.opacity<1&&(window.requestAnimationFrame&&requestAnimationFrame(n)||setTimeout(n,t))};n()}function fadeOut(e,t,o){t=void 0!==t?t:16,o=void 0!==o?o:.05,e.style.opacity=1;var n=function(){e.style.opacity=+e.style.opacity-o,+e.style.opacity>0?window.requestAnimationFrame&&requestAnimationFrame(n)||setTimeout(n,t):e.style.display="none"};n()}function decimalPlaces(e,t){e=+e,-1==(e="a"+(e=Math.round(e*Math.pow(10,t))/Math.pow(10,t))).indexOf(".")&&(e+=".");for(var o=t-(e=e.split("."))[1].length,n=0;n<o;n++)e[1]+="0";return e[0]=e[0].substring(1),e=e.join(".")}function logUpdate(e){d=new Date,console.log(d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()+" "+d.getHours()+":"+(d.getMinutes()<10?"0"+d.getMinutes():d.getMinutes())+": "+e)}function parse_query_string(e){for(var t=e.split("&"),o={},n=0;n<t.length;n++){var a=t[n].split("=");if(void 0===o[a[0]])o[a[0]]=decodeURIComponent(a[1]);else if("string"==typeof o[a[0]]){var r=[o[a[0]],decodeURIComponent(a[1])];o[a[0]]=r}else o[a[0]].push(decodeURIComponent(a[1]))}return o}function setUp(){setUpWeather(),setUpStocks(),setUpNews()}var STOCKS=["IWD","IWF","^IXIC","^GSPC","ES=F"],DEFAULT_LOCATION={coords:{latitude:38.8942345,longitude:-77.0295696}};WEATHER_UPDATE=9e5,STOCKS_UPDATE=3e5,NEWS_UPDATE=6e5;var URLS={weather:"https://www.wunderground.com/",stocks:"https://finance.yahoo.com/portfolio/pf_1/view/v1?bypass=true"};ready(setUp);
